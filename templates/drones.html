{{ define "content" }}
<div class="container mt-4">
  <h1 class="text-center mb-4">Drones</h1>
  <div class="d-flex justify-content-end mb-4">
    <button class="btn btn-custom" data-bs-toggle="modal" data-bs-target="#newDroneModal">Add Drone</button>
  </div>
  <div class="row">
    {{ range $drone := .Drones }}
    <div class="col-md-4 mb-3">
      <div class="card shadow">
        <div class="card-body">
          <h5 class="card-title">{{ $drone.UID }}</h5>
          <p class="card-text">Status: Online</p>

          <!-- View Details Button -->
          <a href="/device/{{ $drone.UID }}" class="btn btn-dark">View Details</a>

          <!-- Delete Button -->
          <button class="btn btn-danger" onclick="deleteDrone('{{ $drone.UID }}')">Delete</button>
        </div>
      </div>
    </div>
    {{ end }}
  </div>
</div>

<div class="modal fade" id="newDroneModal" tabindex="-1" aria-labelledby="newDroneModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title" id="addDroneModalLabel">Add New Drone</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h6>Instructions:</h6>
        <ol>
          <li>Ensure your drone device is powered on.</li>
          <li>Connect your device to a network (if required).</li>
          <li>Open your terminal or command prompt on the device.</li>
          <li>Execute the following command in the terminal:</li>
        </ol>

        <!-- Command to copy -->
        <div class="input-group mb-3">
          <input type="text" class="form-control" id="droneCommand"
            value="wget -O - https://dashboard.dronnayak.com/register/{{ .ID }} | bash" readonly>
          <button class="btn btn-outline-secondary" type="button" id="copyCommandBtn">Copy</button>
        </div>

        <p>Once the command is executed, your drone will be registered and appear in the fleet dashboard.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('copyCommandBtn').addEventListener('click', function () {
    var commandInput = document.getElementById('droneCommand');
    commandInput.select();
    commandInput.setSelectionRange(0, 99999);
    document.execCommand('copy');

    alert('Command copied to clipboard!');
  });
</script>
<script>
  function deleteDrone(droneUID) {
    if (confirm('Are you sure you want to delete this drone?')) {
      fetch(`/device/${droneUID}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
        }
      })
        .then(response => {
          if (response.ok) {
            alert('Drone deleted successfully');
            location.reload();  // Refresh the page after deletion
          } else {
            alert('Error deleting drone. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Something went wrong.');
        });
    }
  }
</script>
{{ end }}